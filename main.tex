\documentclass[10pt,a5paper,twoside]{book}
\usepackage{geometry}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\addto\captionsenglish{\renewcommand{\chaptername}{Day}}

\usepackage{libertine}
\usepackage[scaled=0.95]{inconsolata}
\usepackage{microtype}
\SetTracking
  [ spacing = {25*,166, } ]
  { encoding = *,
    shape = sc }
  { 50 }
\usepackage{xstring}
\usepackage{graphicx}
\usepackage{wallpaper}
\usepackage{listings}
\lstset{
  basicstyle=\normalsize\ttfamily\lst@ifdisplaystyle\footnotesize\fi,
  backgroundcolor=\color{black!6},
  rulecolor=\color{black!25},
  frame=single,
  breaklines=true,
  breakatwhitespace=true,
  keepspaces=true,
  columns=fixed,
  showspaces=false,
  showstringspaces=false,
  xleftmargin=3.4pt,
  xrightmargin=3.4pt,
  framerule=0.4pt,
  belowskip=\smallskipamount,
  language=Perl
}

% Environment to show command-line
\lstnewenvironment{shell}
  {\lstset{morecomment=[l]{cpan>},
           morecomment=[l]{$},
           commentstyle=\bfseries,
           breaklines=true,
           breakatwhitespace=false,
           breakindent=0pt}}
  {}

\usepackage{titlesec}

% Headers and footers
\usepackage{fancyhdr}
\renewcommand{\headrulewidth}{0pt}
\fancypagestyle{main}{%
  \fancyhf{}
  \fancyhead[CO,CE]{\small\nouppercase{\leftmark}}
  \fancyhead[LE,RO]{\sffamily\bfseries\thepage}}
\fancypagestyle{plain}{%
  \fancyhead{}
  \fancyfoot[LE,RO]{\sffamily\bfseries\thepage}}
\pagestyle{main}
\renewcommand{\chaptermark}[1]{%
  \markboth{\sffamily\textsc{\lsstyle\chaptername} \thechapter\ \// #1}{}}
% To have a blank page completely blank before a chapter page
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
  \hbox{}
  \thispagestyle{empty}
  \newpage
  \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother

\usepackage{hyperref}
\let\urlfromhyperref\url
\PassOptionsToPackage{hyphens}{url}

\titleformat{\chapter}[display]
    {\normalfont\rmfamily\filcenter}
    {\Large\scshape\lsstyle \chaptername{} \thechapter}
    {0.5pc}
    {\LARGE\itshape}
\titlespacing*{\chapter}
  {0pt}{*-3}{*10}

\titleformat{\section}
  {\normalfont\bfseries}
  {\llap{\thesection\hspace{1.5ex}}}
  {0pt}
  {}
\titlespacing*{\section}
  {0pt}{*2}{*1}

\renewcommand{\thesection}{\arabic{section}}
\graphicspath{{images/}}

% Create a footnote for each href link
\let\oldhref\href
\renewcommand{\href}[2]{%
  % Every Perl developper knows where to find documentation for Perl modules
  % so there is no need to waste space in the footnote
  \IfSubStr{#1}{cpan.org}{#2}{#2\footnote{\urlfromhyperref{#1}}}%
}

\usepackage[strict]{changepage}
\newenvironment{note}
  {\medskip\begin{adjustwidth}{\parindent}{\parindent}%
    % Why -2pt is needed ?
    \makebox[-2pt][r]{\scshape\lsstyle Note\space}\small}%
  {\end{adjustwidth}\medskip}

%
% Typographical conventions
%
\newcommand*{\sourceFont}{\ttfamily\footnotesize}
\newcommand*{\inlineSourceFont}{\normalsize\ttfamily}
\newcommand*{\urlFont}{\itshape}
\renewcommand*{\UrlFont}{\itshape}
\newcommand*{\fileFont}{\itshape}
\newcommand*{\moduleFont}{\ttfamily}
\newcommand*{\programFont}{\itshape}
% url
\DeclareUrlCommand\url{\def\UrlFont{\urlFont}}
% filename
\DeclareUrlCommand\file{\def\UrlFont{\fileFont}}
% Module or distribution name
% Hyphenation can occur after :: or at |
% Usage: \module{Plack::Mid|dle|wa|re::Ses|sion}
\makeatletter
\DeclareUrlCommand\module{%
  \def\UrlFont{\moduleFont}%
  \def\UrlBigBreaks{\do\:}%
  \g@addto@macro\UrlSpecials{\do\|{\allowbreak}}
}
\makeatother
% Program name
\newcommand*{\program}[1]{{\programFont#1}}

% Command-line switch
\newcommand*{\switch}[1]{\textit{#1}}

% Recompile SVG file to PDF if necessary
\newcommand{\executeiffilenewer}[3]{%
  \ifnum\pdfstrcmp{\pdffilemoddate{#1}}%
  {\pdffilemoddate{#2}}>0%
  \immediate\write18{#3}\fi%
}
% Include an SVG file
\newcommand{\includesvg}[2][]{%
  \executeiffilenewer{#2.svg}{#2.pdf}%
  {inkscape -z -D --file=#2.svg --export-pdf=#2.pdf --export-pdf}%
  \includegraphics[#1]{#2.pdf}%
}
\newcommand{\downloadcoverphoto}[2]{%
  \IfFileExists{images/#1}{}{\immediate\write18{wget -O images/#1 "#2"}}%
}

\newcommand{\inputperl}[1]{%
  \executeiffilenewer{codes/#1}{build/#1}%
  {perltidy codes/#1 -pro=.perltidyrc -l=63 > build/#1}%
  \lstinputlisting{build/#1}
}


\begin{document}

\title{Plack Handbook}
\author{Tatsuhiko Miyagawa}
\date{}

\frontmatter

\include{cover}

\include{copyright}

\tableofcontents

\include{introduction}

\mainmatter

\include{allchapters}

\backmatter

\end{document}

